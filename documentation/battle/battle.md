# Боёвка

## Боевой персонаж

Характеристики:
- Здоровье (hp)
- Атака (atk)
- Защита (def)
- Сила (strength)
- Ловкость (agility)
- Мудрость (wisdom)

## Бой

Боёвка построена на принципе КНБ: сила > ловкость > мудрость > сила
В качестве основного инструмента баланса используются разновидности функций 1/x
- Она стремится к определённому значению, но никогда его не достигает, причём чем больше x, тем медленней растёт функция
- Если нужно определённое значение, к которому стремится функция, достаточно просто сместить по оси Y: 1/x + N
- Если функция растёт слишком быстро, достаточно просто умножить её на некий модификатор: (N * 1)/x
- Просто менять начальное значение путём смещения по оси X: 1/(x + N)

### Преимущество (advantage)
Преимущество Игрок1 перед Игрок2 на основе характеристик
```
сила1 = max(Игрок1.сила - Игрок2.ловкость / 2 - Игрок2.мудрость, 1)
ловкость1 = max(Игрок1.ловкость - Игрок2.мудрость / multiplier - Игрок2.сила, 1)
мудрость1 = max(Игрок1.мудрость - Игрок2.сила / multiplier - Игрок2.ловкость, 1)
сила2 = max(Игрок2.сила - Игрок1.ловкость / multiplier - Игрок1.мудрость, 1)
ловкость2 = max(Игрок2.ловкость - Игрок1.мудрость / multiplier - Игрок1.сила, 1)
мудрость2 = max(Игрок2.мудрость - Игрок1.сила / multiplier - Игрок1.ловкость, 1)
преимущество = (сила1 + ловкость1 + мудрость1) - (сила2 + ловкость2 + мудрость2)
```
Но само по себе преимущество имеет значения от -4.5 до 4.5 (при обычных характеристиках 13/1/1 1/13/1)
Нас интересует только положительный диапазон, от нуля, до, в теории, бесконечности.
Приведём его к значению от нуля до единицы с помощью функции ```-8/(x+8) + 1```
```
fun число преимущество_процент(перимущество) {
    вернуть -8/(преимущество + 8) + 1
}
```

### Уворот
В бою есть шанс увернуться от атаки противника с базовой вероятностью 10%
Ниже реализация функции уворота (шанс от 10% до 80%)
```
fun bool уворот(ловкость1, ловкость2) {
    разница = ловкость1 - ловкость2
    шанс = 10
    смещение_х = -14
    если разница > смещение_х:
        шанс = шанс + max(-1250 / (разница - offset_x) + 70, 0)
    вернуть рандом(1, 100) <= шанс
} 
```

### Критический урон
В бою есть шанс нанести критический урон с базовой вероятностью 10%
Ниже реализации функции крита (шанс от 10 до 80; модификатор от 2 до 3,5)
```
fun число крит(мудрость1, мудрость2) {
    разница = мудрость1 - мудрость2
    шанс = 10
    смещение_шанса_х = -14
    если diff > смещение_шанса_х:
        шанс = шанс + max(-1300 / (разница - смещение_шанса_х) + 70, 0)
    если рандом(1, 100) > шанс:
        вернуть 1
    модификатор = 2
    смещение_модификатора_х = -6
    if разница > смещение_модификатора_х:
        модификатор = модификатор + max(-9 / (разница - смещение_модификатора_х) + 1.5, 0)
    вернуть модификатор
}
```

### Бонус атаки
Атака персонажа не является постоянной величиной, а колеблется от -10 до +10%
Сила персонажа способна увеличить бонус атаки от 0% до 20%.
Ниже реализация
```
fun число бонус_атаки(сила1, сила2) {
    отклонение = 0.1
    бонус = 0
    смещение_х = -10
    разница = сила1 - сила2
    if разница > смещение_х:
        бонус = бонус + max(-1 / (разница - смещение_х) + 0.1, 0)
    вернуть рандом(1 - отклонение, 1 + отклонение) + бонус
}
```

### Один ход боя (Игрок1 против Игрок2)

```
если не уворот(Игрок2.ловкость, Игрок1.ловкость):
    преимущество = Игрок1.преимущество(Игрок2)
    бонус = 1
    если преимущество > 0:
        бонус = бонус + преимущество_процент(преимущество)
        
    атака = Игрок1.атака
     * бонус 
     * крит(Игрок1.мудрость, Игрок2.мудрость)
     * бонус_атаки(Игрок1.сила, Игрок2.сила)
    Игрок2.здоровье -= max(атака - Игрок2.защита, Игрок1.атака * мин_атака)
    
    если Игрок2.здоровье < 0:
        вернуть Игрок2.поражение
```




